<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>Order Management</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

    <style>
        body { background: #f7f7f7; padding: 25px; }
        h2 { font-weight: bold; margin-bottom: 25px; text-align: center; }
        .search-card { border-radius: 10px; padding: 20px; }
        table thead { background: #343a40; color: white; text-align: center; }
        table tbody td { text-align: center; }
        .btn-back { margin-bottom: 20px; } /* èˆ‡æœƒå“¡é ä¸€è‡´ */
        .status-finished { color: #28a745; font-weight: bold; }
        .status-cancel { color: #dc3545; font-weight: bold; }
        .status-processing { color: #007bff; font-weight: bold; }
        .table-container { overflow-x: auto; }
    </style>
    
    <style>
		body {
    		padding-top: 75px; /* å°èˆªåˆ—é«˜åº¦ */
		}
	</style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="employee.html">Gjun Rent - å“¡å·¥ç³»çµ±</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <button class="btn btn-outline-danger btn-sm" onclick="emphandleLogout()">ç™»å‡º</button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
<div class="container">
    <!-- è¿”å›æŒ‰éˆ•ï¼ˆä½ç½®èˆ‡æœƒå“¡é ä¸€è‡´ï¼‰ -->
    <button class="btn btn-secondary btn-back float-right" onclick="window.location.href='employee.html'">â† è¿”å›é¦–é </button>

    <h2>è¨‚å–®è³‡æ–™ç®¡ç†</h2>

    <div class="card search-card shadow-sm">
        <form onsubmit="return false;">
            <div class="row mb-2">
                <div class="col-md-4"><label>æœƒå“¡ç·¨è™Ÿ</label><input type="text" id="memberid_od" class="form-control"></div>
                <div class="col-md-4"><label>æœƒå“¡å§“å</label><input type="text" id="membername_od" class="form-control"></div>
                <div class="col-md-4"><label>èº«åˆ†è­‰å­—è™Ÿ</label><input type="text" id="idnumber_od" class="form-control"></div>
            </div>

            <div class="row mb-2">
                <div class="col-md-4"><label>é›»è©±</label><input type="text" id="phone_od" class="form-control"></div>
                <div class="col-md-4"><label>å–è»Šæ“šé»</label><select id="pickupsta_od" class="form-control"></select></div>
                <div class="col-md-4">
                    <label>è¨‚å–®ç‹€æ…‹</label>
                    <select id="odstatus_od" class="form-control">
                        <option value="">å…¨éƒ¨</option>
                        <option value="é ç´„ä¸­">é ç´„ä¸­</option>
                        <option value="å®Œæˆ">å®Œæˆ</option>
                        <option value="å·²å–æ¶ˆ">å·²å–æ¶ˆ</option>
                    </select>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label>å–è»Šæ—¥æœŸå€é–“</label>
                    <div class="d-flex align-items-center">
                        <input type="date" id="pickupdatestart_od" class="form-control">
                        <span class="mx-2">~</span>
                        <input type="date" id="pickupdateend_od" class="form-control">
                    </div>
                </div>
            </div>

            <div class="text-center mt-3">
                <button id="searchorder" type="button" class="btn btn-primary px-5">ğŸ” æŸ¥è©¢</button>
            </div>
        </form>
    </div>

    <div class="mt-4 table-container">
        <table class="table table-bordered table-hover shadow-sm">
            <thead>
                <tr>
                    <th>è¨‚å–®ç·¨è™Ÿ</th>
                    <th>æœƒå“¡ç·¨è™Ÿ</th>
                    <th>æœƒå“¡å§“å</th>
                    <th>å–è»Šæ—¥æœŸ</th>
                    <th>é‚„è»Šæ—¥æœŸ</th>
                    <th>è¨‚å–®æ—¥æœŸ</th>
                    <th>å–è»Šæ“šé»</th>
                    <th>é‚„è»Šæ“šé»</th>
                    <th>è¨‚å–®é‡‘é¡</th>
                    <th>è¨‚å–®ç‹€æ…‹</th>
                    <th>æŸ¥çœ‹æ˜ç´°</th>
                </tr>
            </thead>
            <tbody id="allorderTable"></tbody>
        </table>

        <!-- åˆ†é æŒ‰éˆ• -->
        <div id="pagination" class="text-center mt-3"></div>
    </div>
</div>

<script src="js/member.js"></script>
<script>
let orderData = [];
let currentPage = 1;
const pageSize = 10;

// æŸ¥è©¢
$("#searchorder").click(function () {
    $("#allorderTable").empty();
    $("#pagination").empty();

    $.ajax({
        url: "/order/search",
        type: "GET",
        data: {
            memberId: $("#memberid_od").val(),
            name: $("#membername_od").val(),
            idNumber: $("#idnumber_od").val(),
            phone: $("#phone_od").val(),
            pickupStation: $("#pickupsta_od").val(),
            orderStatus: $("#odstatus_od").val(),
            pickupDateStart: $("#pickupdatestart_od").val(),
            pickupDateEnd: $("#pickupdateend_od").val()
        },
        success: function (data) {
            orderData = data;
            if (orderData.length === 0) {
                alert("æŸ¥ç„¡è³‡æ–™");
                return;
            }
            currentPage = 1;
            renderTable();
            renderPagination();
        }
    });
});

// æ¸²æŸ“è¡¨æ ¼
function renderTable() {
    $("#allorderTable").empty();
    let start = (currentPage - 1) * pageSize;
    let pageList = orderData.slice(start, start + pageSize);

    pageList.forEach(o => {
        let statusClass =
            o.orderStatus === "å®Œæˆ" ? "status-finished" :
            o.orderStatus === "å–æ¶ˆ" ? "status-cancel" :
            "status-processing";

        $("#allorderTable").append(`
            <tr>
                <td>${o.orderId}</td>
                <td>${o.memberId}</td>
                <td>${o.name}</td>
                <td>${o.pickupDate}</td>
                <td>${o.returnDate}</td>
                <td>${o.orderDate}</td>
                <td>${o.pickupStation}</td>
                <td>${o.returnStation}</td>
                <td>${o.totalPrice}</td>
                <td class="${statusClass}">${o.orderStatus}</td>
                <td><button class="btn btn-info btn-sm" onclick="viewDetail('${o.orderId}')">æŸ¥çœ‹</button></td>
            </tr>
        `);
    });
}

// åˆ†é 
function renderPagination() {
    $("#pagination").empty();
    let totalPages = Math.ceil(orderData.length / pageSize);
    for (let i = 1; i <= totalPages; i++) {
        $("#pagination").append(`
            <button class="btn btn-outline-primary m-1 ${i === currentPage ? "active" : ""}"
                    onclick="changePage(${i})">${i}</button>
        `);
    }
}

function changePage(page) {
    currentPage = page;
    renderTable();
    renderPagination();
}

// æŸ¥çœ‹æ˜ç´°
function viewDetail(orderId) {
    location.href = "orderdetail.html?orderId=" + orderId;
}
</script>

<script src="js/employee.js"></script>
</body>
</html>
