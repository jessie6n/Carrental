<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>æœƒå“¡ä¸­å¿ƒ - æˆ‘çš„è¨‚å–® | GOTO Rent</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

    <style>
        body {
            padding-top: 70px;
        }

        .order-card:hover {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            transition: 0.2s;
        }

        .profile-box {
            background: #f8f9fa;
            border-radius: .5rem;
            padding: 1rem 1.25rem;
        }
    </style>
</head>

<body>

    <!-- ğŸ”¹ Navbarï¼ˆè·Ÿé¦–é é¢¨æ ¼ä¸€è‡´ï¼‰ -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="car-rental.html">GOTO Rent</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" id="homepagebtn">é¦–é </a></li>
                    <li class="nav-item"><a class="nav-link active" id="myorderbtn">æˆ‘çš„è¨‚å–®</a></li>
                    <li class="nav-item"><button class="nav-link active" id="updatebtn">è®Šæ›´æœƒå“¡è³‡æ–™</button></li>
                    <li class="nav-item">
                        <div id="welcome-message" style="color: yellow"></div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- â—ç™»å…¥ç”¨ Modalï¼ˆå¯ä»¥ç›´æ¥æ²¿ç”¨ä½ ä¹‹å‰çš„ï¼Œä¹Ÿå¯ä»¥å…ˆæ”¾ç©ºæ®¼ï¼‰ -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">æœƒå“¡ç™»å…¥</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-0">é€™è£¡å¯ä»¥æ”¾ä½ ä¹‹å‰åšå¥½çš„ç™»å…¥è¡¨å–®ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”¹ æœƒå“¡ä¸­å¿ƒé é¦– -->
    <div class="container mt-4">
        <div class="row g-3 align-items-center">
            <div class="col-md-8">
                <h2 class="h4 mb-1">æœƒå“¡ä¸­å¿ƒ</h2>
                <p class="text-muted mb-0">ç®¡ç†æ‚¨çš„å€‹äººè³‡æ–™èˆ‡ç§Ÿè»Šè¨‚å–®ã€‚</p>
            </div>
            <div class="col-md-4">
                <div class="profile-box">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-bold" id="memberName">GOTO æœƒå“¡</div>
                            <div class="small text-muted" id="memberEmail">member@example.com</div>
                        </div>
                        <span class="badge bg-primary">ä¸€èˆ¬æœƒå“¡</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”¹ Tabsï¼šç›®å‰åªç”¨ã€Œæˆ‘çš„è¨‚å–®ã€ï¼Œä¹‹å¾Œå¯å†åŠ å…¶å®ƒ -->
    <div class="container mt-3">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-orders">
                    æˆ‘çš„è¨‚å–®
                </button>
            </li>
            <!-- ä¹‹å¾Œå¯ä»¥æ–°å¢ï¼š
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-profile">æœƒå“¡è³‡æ–™</button></li>
        -->
        </ul>

        <div class="tab-content border border-top-0 p-3">
            <!-- æˆ‘çš„è¨‚å–® Tab -->
            <div class="tab-pane fade show active" id="tab-orders">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="h5 mb-0">è¨‚å–®åˆ—è¡¨</h3>
                    <small class="text-muted">é»æ“Šã€Œä¿®æ”¹æ—¥æœŸã€æˆ–ã€Œå–æ¶ˆè¨‚å–®ã€æ“ä½œ</small>
                </div>

                <div id="order-list" class="row g-3">
                    <!-- JS render -->
                </div>
            </div>

            <!-- é ç•™ï¼šæœƒå“¡è³‡æ–™ Tab
        <div class="tab-pane fade" id="tab-profile">
            ...
        </div>
        -->
        </div>
    </div>

    <!-- ğŸ”¹ è¨‚å–®è©³ç´° Modal -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">è¨‚å–®è©³ç´°è³‡æ–™</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <p id="detail-car-name" class="fw-bold"></p>
                    <p id="detail-date-range"></p>
                    <p id="detail-price"></p>
                    <p id="detail-status" class="fw-bold"></p>
                    <hr>
                    <p class="small text-muted mb-0">è¨‚å–®ç·¨è™Ÿï¼š</p>
                    <p id="detail-order-id" class="small"></p>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
                </div>

            </div>
        </div>
    </div>

    <!-- ğŸ”¹ ä¿®æ”¹å–é‚„è»Šæ—¥æœŸ Modal -->
    <div class="modal fade" id="editDateModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">ä¿®æ”¹ç§ŸæœŸ</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label class="form-label">å–è»Šæ—¥æœŸ</label>
                            <input type="date" class="form-control" id="editPickupDate">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">é‚„è»Šæ—¥æœŸ</label>
                            <input type="date" class="form-control" id="editReturnDate">
                        </div>
                        <p class="text-muted small mb-0">
                            â€» æ­¤è™•ç›®å‰åƒ…ç‚ºå‰ç«¯ä¿®æ”¹ç¤ºæ„ï¼Œå¯¦å‹™ä¸Šéœ€å‘¼å«å¾Œç«¯ API é©—è­‰å¯å¦ä¿®æ”¹ã€‚
                        </p>
                    </form>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button class="btn btn-primary" id="saveDateBtn">å„²å­˜è®Šæ›´ï¼ˆå‰ç«¯ç¤ºç¯„ï¼‰</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // =========================
        //   å‡è³‡æ–™å€ï¼šä¹‹å¾Œå¯ç”¨ API å–ä»£
        // =========================
        let sampleOrders = [
            {
                orderId: "A20250101-001",
                carName: "Toyota Vios",
                pickupDate: "2025-01-12",
                returnDate: "2025-01-15",
                price: 3600,
                status: "å·²å®Œæˆ",
                imageUrl: "https://picsum.photos/seed/vios/400/250"
            },
            {
                orderId: "A20250110-002",
                carName: "Honda Civic",
                pickupDate: "2025-01-20",
                returnDate: "2025-01-23",
                price: 5400,
                status: "å·²å–æ¶ˆ",
                imageUrl: "https://picsum.photos/seed/civic/400/250"
            },
            {
                orderId: "A20250118-003",
                carName: "Toyota RAV4",
                pickupDate: "2025-02-02",
                returnDate: "2025-02-04",
                price: 4800,
                status: "é€²è¡Œä¸­",
                imageUrl: "https://picsum.photos/seed/rav4/400/250"
            }
        ];

        let editingOrderId = null;

        // ============ å…±ç”¨å°å·¥å…· ============

        function getStatusBadgeClass(status) {
            switch (status) {
                case "å·²å®Œæˆ": return "bg-success";
                case "å·²å–æ¶ˆ": return "bg-secondary";
                case "é€²è¡Œä¸­": return "bg-warning text-dark";
                default: return "bg-light text-dark";
            }
        }

        // ============ æ¸²æŸ“è¨‚å–®åˆ—è¡¨ ============

        function renderOrders() {
            const list = document.getElementById("order-list");
            list.innerHTML = "";

            if (!sampleOrders || sampleOrders.length === 0) {
                list.innerHTML = `<p class="text-muted">ç›®å‰æ²’æœ‰è¨‚å–®ã€‚</p>`;
                return;
            }

            sampleOrders.forEach(order => {
                const col = document.createElement("div");
                col.className = "col-md-6 col-lg-4";

                col.innerHTML = `
            <div class="card order-card h-100">
                <img src="${order.imageUrl}" class="card-img-top" alt="${order.carName}">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">${order.carName}</h5>
                    <p class="card-text mb-1">${order.pickupDate} ~ ${order.returnDate}</p>
                    <p class="fw-bold text-primary mb-2">NT$ ${order.price}</p>
                    <span class="badge ${getStatusBadgeClass(order.status)} mb-2">${order.status}</span>

                    <div class="mt-auto d-flex gap-2">
                        <button class="btn btn-sm btn-outline-secondary flex-fill"
                                onclick="openOrderDetail('${order.orderId}')">
                            è©³ç´°
                        </button>
                        <button class="btn btn-sm btn-outline-primary flex-fill"
                                onclick="openEditDate('${order.orderId}')"
                                ${order.status !== "é€²è¡Œä¸­" ? "disabled" : ""}>
                            ä¿®æ”¹æ—¥æœŸ
                        </button>
                        <button class="btn btn-sm btn-outline-danger flex-fill"
                                onclick="cancelOrder('${order.orderId}')"
                                ${order.status !== "é€²è¡Œä¸­" ? "disabled" : ""}>
                            å–æ¶ˆè¨‚å–®
                        </button>
                    </div>
                </div>
            </div>
        `;

                list.appendChild(col);
            });
        }

        // ============ è¨‚å–®è©³ç´° ============

        function openOrderDetail(orderId) {
            const order = sampleOrders.find(o => o.orderId === orderId);
            if (!order) return;

            document.getElementById("detail-car-name").innerText = order.carName;
            document.getElementById("detail-date-range").innerText =
                `${order.pickupDate} ~ ${order.returnDate}`;
            document.getElementById("detail-price").innerText =
                `ç¸½é‡‘é¡ï¼šNT$ ${order.price}`;
            document.getElementById("detail-status").innerHTML =
                `ç‹€æ…‹ï¼š<span class="badge ${getStatusBadgeClass(order.status)}">${order.status}</span>`;
            document.getElementById("detail-order-id").innerText = order.orderId;

            new bootstrap.Modal(document.getElementById("orderDetailModal")).show();
        }

        // ============ ä¿®æ”¹æ—¥æœŸ ============

        function openEditDate(orderId) {
            const order = sampleOrders.find(o => o.orderId === orderId);
            if (!order) return;

            editingOrderId = orderId;
            document.getElementById("editPickupDate").value = order.pickupDate;
            document.getElementById("editReturnDate").value = order.returnDate;

            new bootstrap.Modal(document.getElementById("editDateModal")).show();
        }

        document.getElementById("saveDateBtn").addEventListener("click", function () {
            if (!editingOrderId) return;
            const pickup = document.getElementById("editPickupDate").value;
            const ret = document.getElementById("editReturnDate").value;

            if (!pickup || !ret) {
                alert("è«‹é¸æ“‡å–è»Šèˆ‡é‚„è»Šæ—¥æœŸ");
                return;
            }

            const order = sampleOrders.find(o => o.orderId === editingOrderId);
            if (!order) return;

            // å‰ç«¯ç›´æ¥æ”¹è³‡æ–™ï¼ˆç¤ºç¯„ç”¨ï¼‰
            order.pickupDate = pickup;
            order.returnDate = ret;

            // é—œé–‰ modal
            const modalEl = document.getElementById("editDateModal");
            const modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();

            // é‡æ–° render
            renderOrders();

            // å¯¦å‹™ä¸Šæ‡‰è©²æ”¹æˆ call APIï¼š
            // fetch(`/api/orders/${editingOrderId}/period`, { method: "PUT", body: JSON.stringify({...}) })
            alert("ç›®å‰åƒ…ç‚ºå‰ç«¯ç¤ºç¯„ï¼Œå¯¦å‹™ä¸Šéœ€å‘¼å«å¾Œç«¯ API æ›´æ–°è¨‚å–®ã€‚");
        });

        // ============ å–æ¶ˆè¨‚å–® ============

        function cancelOrder(orderId) {
            const order = sampleOrders.find(o => o.orderId === orderId);
            if (!order) return;

            if (order.status !== "é€²è¡Œä¸­") {
                alert("åªæœ‰é€²è¡Œä¸­çš„è¨‚å–®å¯ä»¥å–æ¶ˆã€‚");
                return;
            }

            if (!confirm(`ç¢ºå®šè¦å–æ¶ˆè¨‚å–® ${orderId} å—ï¼Ÿ`)) {
                return;
            }

            // å‰ç«¯ç›´æ¥æ”¹ç‹€æ…‹ï¼ˆç¤ºç¯„ç”¨ï¼‰
            order.status = "å·²å–æ¶ˆ";
            renderOrders();

            // å¯¦å‹™ä¸Šé€™è£¡æ‡‰è©²æ˜¯ï¼š
            // fetch(`/api/orders/${orderId}/cancel`, { method: "POST" })
        }

        // ============ åˆå§‹åŒ– ============

        document.addEventListener("DOMContentLoaded", function () {
            renderOrders();

            // ä¹‹å¾Œå¯ä»¥æŠŠæœƒå“¡è³‡è¨Šå¾ç™»å…¥å¾Œçš„è³‡æ–™å¸¶é€²ä¾†
            // ä¾‹å¦‚å¾ LocalStorage æˆ– /api/me å–å¾—
            // document.getElementById("memberName").innerText = currentUser.name;
            // document.getElementById("memberEmail").innerText = currentUser.email;
        });
    </script>
	<script src="js/member.js"></script>
</body>

</html>